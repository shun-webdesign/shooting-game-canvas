{"version":3,"file":"index-78897a62.js","sources":["../../src/main.js"],"sourcesContent":["let canvas, context;\nlet width, height, cx, cy;\nconst stars = new Map();\nconst beams = new Map();\nlet enemies = new Map();\nlet [vx, vy] = [0, 0];\nlet startTime, score = 0;\nlet status = \"ready\";\n\n// キャンバスサイズをウィンドウサイズに合わせて設定\nfunction resizeCanvas() {\n    width = window.innerWidth;\n    height = window.innerHeight;\n    [cx, cy] = [width / 2, height / 2];\n\n    if (canvas) {\n        canvas.width = width;\n        canvas.height = height;\n    }\n}\n\n// ビームクラス\nclass Beam {\n    constructor(n) {\n        this.x = n * width;\n        this.y = height;\n        // ビームの移動方向\n        this.dx = (cx - this.x) / 19;\n        this.dy = -cy / 19;\n        this.status = \"alive\";\n    }\n\n    update(vx, vy) {\n        this.x += this.dx - vx / 2;\n        this.y += this.dy - vy / 2;\n        // ビームの移動を小さくする\n        this.dx *= 0.95;\n        this.dy *= 0.95;\n        // 黄色の直線でビームを描く\n        context.beginPath();\n        context.moveTo(this.x, this.y);\n        context.lineTo(this.x + this.dx, this.y + this.dy);\n        context.stroke();\n        // 移動が1未満ならビームを消す\n        if (Math.abs(this.dx) < 1) this.status = \"Dead\";\n    }\n}\n\nclass Enemy {\n    constructor() {\n        this.x = Math.random() * (width - 100) + 50;\n        this.y = Math.random() * (height - 100) + 50;\n        this.vx = Math.random() * Math.sign(cx - this.x);\n        this.vy = Math.random() * Math.sign(cy - this.y);\n        this.size = 0;\n        this.delay = 10;\n        this.status = \"alive\";\n    }\n\n    update(vx, vy) {\n        this.x += this.vx - vx;\n        this.y += this.vy - vy;\n        if (this.status == \"alive\") {\n            // エイリアン\n            drawText(\"0x1F47E\", this.x, this.y, this.size, \"center\");\n            this.size += 0.2;\n            if (this.size > 100) {\n                [this.size, this.delay] = [this.size + 5, this.delay - 1];\n            }\n        } else if (this.status == \"explosion\") {\n            // 爆発\n            drawText(\"0x1F4A5\", this.x, this.y, this.size, \"center\");\n            this.size += 5;\n            this.delay--;\n        }\n        if (this.delay == 0) this.status = \"Dead\"; // 遅延表示カウントが0になったら敵を消す\n    }\n}\n\n// 星クラス\nclass Star {\n    constructor() {\n        this.x = Math.random() * width * 2 - cx;\n        this.y = Math.random() * height * 2 - cy;\n        this.speed = Math.random() * 2 + 0.1;\n    }\n    update(vx, vy) {\n        this.x -= vx * this.speed;\n        this.y -= vy * this.speed;\n        if ((this.x < -cx) || (this.x > width + cx)) this.x = width - this.x;\n        if ((this.y < -cy) || (this.y > height + cy)) this.y = height - this.y;\n        context.fillStyle = \"white\";\n        context.fillRect(this.x, this.y, this.speed, this.speed);\n    }\n}\n\n// 初期化関数\nconst init = () => {\n    canvas = document.getElementById(\"stage\");\n    context = canvas.getContext(\"2d\");\n    context.lineWidth = 2;\n\n    // キャンバスのサイズを設定\n    resizeCanvas();\n\n    // リサイズイベントの登録\n    window.addEventListener('resize', resizeCanvas);\n\n    // マウスイベントの登録\n    canvas.addEventListener(\"mouseleave\", () => [vx, vy] = [0, 0]);\n    canvas.addEventListener(\"mousemove\", event => {\n        [vx, vy] = [(event.offsetX - cx) / 50, (event.offsetY - cy) / 50];\n    });\n    canvas.addEventListener(\"click\", () => { if (status != \"Play\") startGame(); });\n\n    // 星の作成\n    for (let i = 0; i < 200; i++) stars.set(i, new Star());\n\n    // ゲームの更新ループを開始\n    update();\n}\n\n// ゲーム開始関数\nconst startGame = () => {\n    enemies.clear();\n    [startTime, score, status] = [Date.now(), 0, \"Play\"];\n}\n\n// 更新関数\nconst update = () => {\n    context.fillStyle = \"black\";\n    context.fillRect(0, 0, width, height);\n    stars.forEach(star => star.update(vx, vy));\n\n    let time = 600 - Math.floor((Date.now() - startTime) / 100);\n    if (time <= 0) status = \"Retry\";\n\n    let fire = false;\n    if ((Math.floor(time) % 20 == 0) && (!enemies.has(time))) {\n        enemies.set(time, new Enemy());\n        enemies = new Map([...enemies].sort((a, b) => a[0] - b[0]));\n    }\n    enemies.forEach((enemy, i) => {\n        enemy.update(vx, vy);\n        if (Math.hypot(enemy.x - cx, enemy.y - cy) < enemy.size / 3) fire = true;\n        if (enemy.status == \"Dead\") enemies.delete(i);\n    });\n\n    if ((fire) && (status == \"Play\")) beams.set(time, new Beam(time % 2));\n    beams.forEach((beam, i) => {\n        beam.update(vx, vy);\n        if (beam.status == \"Dead\") beams.delete(i);\n        enemies.forEach(enemy => {\n            if (Math.hypot(beam.x - enemy.x, beam.y - enemy.y) < enemy.size / 3) {\n                if (enemy.status == \"alive\") {\n                    score += 10;\n                    enemy.status = \"explosion\";\n                }\n            }\n        });\n    });\n\n    context.strokeStyle = \"cyan\";\n    if ((fire) && (status == \"play\")) context.strokeStyle = \"red\";\n    context.setLineDash([10, 20, 20, 20, 20, 20, 20, 20, 20, 10]);\n    context.strokeRect(cx - 20, cy - 20, 40, 40);\n\n    if (status != \"Play\") {\n        drawText(\"TIME UP!\", cx, cy + 40, 20, \"center\");\n        time = 600;\n        if (status == \"Retry\") {\n            drawText(\"TIME UP!\", cx, cy - 40, 20, \"center\");\n            time = 0;\n        }\n    }\n    drawText(\"SCORE : \" + score, 5, 20);\n    drawText(\"TIME : \" + (time / 10).toFixed(1), width - 130, 20);\n\n    window.requestAnimationFrame(update);\n}\n\nconst drawText = (text, x, y, size = 20, align = \"left\") => {\n    let str = String(text);\n    if (str.indexOf(\"0x\") > -1) {\n        str = String.fromCodePoint(parseInt(str.substring(2), 16));\n    }\n    context.font = `${size}px Arial Black`;\n    context.textAlign = align;\n    context.textBaseline = \"middle\";\n    context.fillStyle = \"white\";\n    context.fillText(str, x, y);\n};\n\nwindow.onload = init;\n"],"names":["canvas","context","width","height","cx","cy","stars","beams","enemies","vx","vy","startTime","score","status","resizeCanvas","Beam","n","Enemy","drawText","Star","init","event","startGame","i","update","star","time","fire","a","b","enemy","beam","text","x","y","size","align","str"],"mappings":"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"}